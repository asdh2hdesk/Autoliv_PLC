<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        
        <!-- PLC Cycle Tree View -->
        <record id="view_plc_cycle_list" model="ir.ui.view">
            <field name="name">plc.cycle.list</field>
            <field name="model">plc.cycle</field>
            <field name="arch" type="xml">
                <list string="PLC Cycles" decoration-success="result == 'ok'" decoration-danger="result == 'nok'" decoration-info="result == 'pending'">
                    <field name="cycle_number"/>
                    <field name="part_name"/>
                    <field name="barcode"/>
                    <field name="cycle_datetime"/>
                    <field name="torque_nm"/>
                    <field name="s1_for"/>
                    <field name="s2_for"/>
                    <field name="final_position"/>
                    <field name="cycle_time"/>
                    <field name="result" widget="badge"/>
                    <field name="qr_code_printed" widget="boolean_toggle"/>
                    <field name="qr_code_scanned" widget="boolean_toggle"/>
                    <field name="qr_match_status" widget="badge"/>
                    <field name="operator_id"/>
                    <field name="workstation_id"/>
                    <button name="action_print_selected" string="Print" type="object" icon="fa-print" class="btn-primary" title="Print QR Code for selected cycles"/>
                </list>
            </field>
        </record>
        
        <!-- PLC Cycle Form View -->
        <record id="view_plc_cycle_form" model="ir.ui.view">
            <field name="name">plc.cycle.form</field>
            <field name="model">plc.cycle</field>
            <field name="arch" type="xml">
                <form edit="false" string="PLC Cycle">
                    <header>
<!--                        <button name="action_mark_ok" string="Mark OK" type="object" class="btn-primary" modifiers="{'invisible': [('result', '!=', 'pending')]}"/>-->
<!--                        <button name="action_mark_nok" string="Mark NOK" type="object" class="btn-secondary" modifiers="{'invisible': [('result', '!=', 'pending')]}"/>-->
                        <button name="action_print_selected" string="Print QR Code" type="object" class="btn-info" icon="fa-print"/>
<!--                        <button name="action_scan_qr" string="Scan QR Code" type="object" class="btn-warning"/>-->
                        <field name="result" widget="statusbar" statusbar_visible="ok,nok"/>
                    </header>
                    <sheet>
                        <div class="oe_title">
                            <h1>
                                <field name="cycle_number" readonly="1"/>
                            </h1>
                        </div>
                        <group>
                            <group>
                                <field name="part_name"/>
                                <field name="barcode"/>
                                <field name="cycle_datetime"/>
                                <field name="operator_id"/>
                                <field name="workstation_id"/>
                            </group>
                            <group>
                                <field name="torque_nm"/>
                                <field name="initial_position"/>
                                <field name="forward_load_after"/>
                                <field name="final_position"/>
                                <field name="cycle_time"/>
                            </group>
                        </group>
                        <group string="CLUTCH Machine Measurements">
                            <group>
                                <field name="zero_position"/>
                                <field name="s1_for"/>
                                <field name="s2_for"/>
<!--                                <field name="s2_rev"/>-->
<!--                                <field name="s1_rev"/>-->
                            </group>
                            <group>
                                <field name="initial_position_revload"/>
                            </group>
                        </group>
                        <group>
                            <group>
                                <field name="qr_code_printed" widget="boolean_toggle"/>
                                <field name="qr_code_scanned" widget="boolean_toggle"/>
                                <field name="qr_match_status" widget="badge"/>
                                <field name="scan_datetime" modifiers="{'invisible': [('qr_code_scanned', '=', False)]}"/>
                                <field name="qr_scan_datetime" modifiers="{'invisible': [('qr_match_status', '=', 'pending')]}"/>
                            </group>
                            <group>
                                <field name="is_quality_pass" widget="boolean_toggle"/>
                            </group>
                        </group>
                        <group>
                            <field name="notes" placeholder="Additional notes about this cycle..."/>
                        </group>
                        <group string="QR Code Information" modifiers="{'invisible': [('qr_code_data', '=', False)]}">
                            <field name="qr_code_data" widget="text" readonly="1"/>
                            <field name="qr_code_image" widget="image" readonly="1"/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>
        
        <!-- PLC Cycle Search View -->
        <record id="view_plc_cycle_search" model="ir.ui.view">
            <field name="name">plc.cycle.search</field>
            <field name="model">plc.cycle</field>
            <field name="arch" type="xml">
                <search string="Search PLC Cycles">
                    <field name="cycle_number"/>
                    <field name="part_name"/>
                    <field name="barcode"/>
                    <field name="operator_id"/>
                    <field name="workstation_id"/>
                    <filter string="OK" name="ok" domain="[('result', '=', 'ok')]"/>
                    <filter string="NOK" name="nok" domain="[('result', '=', 'nok')]"/>
                    <filter string="Pending" name="pending" domain="[('result', '=', 'pending')]"/>
                    <filter string="QR Printed" name="qr_printed" domain="[('qr_code_printed', '=', True)]"/>
                    <filter string="QR Scanned" name="qr_scanned" domain="[('qr_code_scanned', '=', True)]"/>
                    <separator/>
                    <filter string="Today" name="today" domain="[('cycle_datetime', '>=', datetime.datetime.combine(context_today(), datetime.time(0,0,0)))]"/>
                    <filter string="This Week" name="this_week" domain="[('cycle_datetime', '>=', (context_today() - datetime.timedelta(days=context_today().weekday())).strftime('%Y-%m-%d'))]"/>
                    <separator/>
                    <group expand="0" string="Group By">
                        <filter string="Result" name="group_result" context="{'group_by': 'result'}"/>
                        <filter string="Part Name" name="group_part" context="{'group_by': 'part_name'}"/>
                        <filter string="Operator" name="group_operator" context="{'group_by': 'operator_id'}"/>
                        <filter string="Workstation" name="group_workstation" context="{'group_by': 'workstation_id'}"/>
                        <filter string="Date" name="group_date" context="{'group_by': 'cycle_datetime:day'}"/>
                    </group>
                </search>
            </field>
        </record>
        
        <!-- PLC Cycle Kanban View -->
        <record id="view_plc_cycle_kanban" model="ir.ui.view">
            <field name="name">plc.cycle.kanban</field>
            <field name="model">plc.cycle</field>
            <field name="arch" type="xml">
                <kanban string="PLC Cycles" class="o_kanban_small_column">
                    <field name="cycle_number"/>
                    <field name="part_name"/>
                    <field name="barcode"/>
                    <field name="result"/>
                    <field name="torque_nm"/>
                    <field name="cycle_time"/>
                    <field name="qr_code_printed"/>
                    <field name="qr_code_scanned"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div class="oe_kanban_card oe_kanban_global_click">
                                <div class="oe_kanban_content">
                                    <div class="o_kanban_record_top">
                                        <div class="o_kanban_record_headings">
                                            <strong class="o_kanban_record_title">
                                                <field name="cycle_number"/>
                                            </strong>
                                            <div class="o_kanban_record_subtitle">
                                                <field name="part_name"/>
                                            </div>
                                        </div>
                                        <div class="o_kanban_record_body">
                                            <div class="o_kanban_record_details">
                                                <div>Barcode: <field name="barcode"/></div>
                                                <div>Torque: <field name="torque_nm"/> Nm</div>
                                                <div>Time: <field name="cycle_time"/>s</div>
                                            </div>
                                        </div>
                                        <div class="o_kanban_record_bottom">
                                            <div class="oe_kanban_bottom_left">
                                                <span t-attf-class="badge badge-#{record.result.raw_value == 'ok' and 'success' or record.result.raw_value == 'nok' and 'danger' or 'info'}">
                                                    <field name="result"/>
                                                </span>
                                            </div>
                                            <div class="oe_kanban_bottom_right">
                                                <i class="fa fa-print" modifiers="{'invisible': [('qr_code_printed', '=', False)]}" title="QR Code Printed"/>
                                                <i class="fa fa-qrcode" modifiers="{'invisible': [('qr_code_scanned', '=', False)]}" title="QR Code Scanned"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>
        
        <!-- PLC Cycle Action -->
        <record id="action_plc_cycle" model="ir.actions.act_window">
            <field name="name">PLC Cycles</field>
            <field name="res_model">plc.cycle</field>
            <field name="view_mode">list,kanban,form</field>
            <field name="search_view_id" ref="view_plc_cycle_search"/>
            <field name="context">{'search_default_today': 1}</field>
        </record>
        
    </data>
</odoo>
